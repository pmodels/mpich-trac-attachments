<html><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; "><div>My reading of the 2.1 spec is that it's legal to call MPI_Allreduce() or MPI_Reduce() with a NULL sendbuf and recvbuf if the count argument is zero.  Do you agree?  If so, then the 1.1.0a code has a bug: MPIR_ERRTEST_ALIAS_COLL() trips because it thinks the two buffers are aliased.</div><div><br></div><div>The patch below fixes this.  Perhaps MPIR_ERRTEST_ALIAS() also needs a fix, but I think it's unreferenced, so I'm not sure what its intended use is.</div><div><br></div><div>Apologies for nit-picking.  I had a test failing over this.  If you believe my reading of the spec is wrong, let me know and I'll fix my test instead.</div><div><br></div><div>-dg</div><div><br></div><div><div>--</div><div>David Gingold</div><div>Principal Software Engineer</div><div>SiCortex</div><div>Three Clock Tower Place, Suite 210</div><div>Maynard MA 01754</div><div>(978) 897-0214 x224</div><div><br></div><div>....</div></div><div><br></div><div>Index: src/include/mpierrs.h</div><div>===================================================================</div><div>--- src/include/mpierrs.h<span class="Apple-tab-span" style="white-space:pre">	</span>(revision 63679)</div><div>+++ src/include/mpierrs.h<span class="Apple-tab-span" style="white-space:pre">	</span>(working copy)</div><div>@@ -105,8 +105,8 @@</div><div> <span class="Apple-tab-span" style="white-space:pre">				</span>   "**bufalias", 0 );<span class="Apple-tab-span" style="white-space:pre">		</span>\</div><div>     }</div><div> </div><div>-#define MPIR_ERRTEST_ALIAS_COLL(ptr1,ptr2,err)<span class="Apple-tab-span" style="white-space:pre">			</span>\</div><div>-    if ((ptr1)==(ptr2)) {<span class="Apple-tab-span" style="white-space:pre">		</span>                        \</div><div>+#define MPIR_ERRTEST_ALIAS_COLL(ptr1,ptr2,count,err)<span class="Apple-tab-span" style="white-space:pre">		</span>\</div><div>+    if ((count > 0) &amp;&amp; ((ptr1)==(ptr2))) {                      \</div><div>         err = MPIR_Err_create_code(MPI_SUCCESS,<span class="Apple-tab-span" style="white-space:pre">			</span>\</div><div> <span class="Apple-tab-span" style="white-space:pre">				</span>   MPIR_ERR_RECOVERABLE,<span class="Apple-tab-span" style="white-space:pre">	</span>\</div><div> <span class="Apple-tab-span" style="white-space:pre">				</span>   FCNAME, __LINE__,<span class="Apple-tab-span" style="white-space:pre">		</span>\</div><div>Index: src/mpi/coll/reduce.c</div><div>===================================================================</div><div>--- src/mpi/coll/reduce.c<span class="Apple-tab-span" style="white-space:pre">	</span>(revision 63679)</div><div>+++ src/mpi/coll/reduce.c<span class="Apple-tab-span" style="white-space:pre">	</span>(working copy)</div><div>@@ -814,7 +814,7 @@</div><div>             if (mpi_errno != MPI_SUCCESS) goto fn_fail;</div><div>         }</div><div> </div><div>-<span class="Apple-tab-span" style="white-space:pre">	</span>MPIR_ERRTEST_ALIAS_COLL(sendbuf, recvbuf, mpi_errno);</div><div>+<span class="Apple-tab-span" style="white-space:pre">	</span>MPIR_ERRTEST_ALIAS_COLL(sendbuf, recvbuf, count, mpi_errno);</div><div> <span class="Apple-tab-span" style="white-space:pre">	</span>if (mpi_errno != MPI_SUCCESS) goto fn_fail;</div><div> </div><div>         MPID_END_ERROR_CHECKS;</div><div>Index: src/mpi/coll/allreduce.c</div><div>===================================================================</div><div>--- src/mpi/coll/allreduce.c<span class="Apple-tab-span" style="white-space:pre">	</span>(revision 63679)</div><div>+++ src/mpi/coll/allreduce.c<span class="Apple-tab-span" style="white-space:pre">	</span>(working copy)</div><div>@@ -664,7 +664,7 @@</div><div> <span class="Apple-tab-span" style="white-space:pre">	</span>    if (mpi_errno != MPI_SUCCESS) goto fn_fail;</div><div>         }</div><div> </div><div>-<span class="Apple-tab-span" style="white-space:pre">	</span>MPIR_ERRTEST_ALIAS_COLL(sendbuf, recvbuf, mpi_errno);</div><div>+<span class="Apple-tab-span" style="white-space:pre">	</span>MPIR_ERRTEST_ALIAS_COLL(sendbuf, recvbuf, count, mpi_errno);</div><div> <span class="Apple-tab-span" style="white-space:pre">	</span>if (mpi_errno != MPI_SUCCESS) goto fn_fail;</div><div> </div><div>         MPID_END_ERROR_CHECKS;</div><div><br></div>
<br><br><div> <span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><span class="Apple-style-span" style="border-collapse: separate; border-spacing: 0px 0px; color: rgb(0, 0, 0); font-family: Helvetica; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-align: auto; -khtml-text-decorations-in-effect: none; text-indent: 0px; -apple-text-size-adjust: auto; text-transform: none; orphans: 2; white-space: normal; widows: 2; word-spacing: 0px; "><div><br></div></span></span></div></body></html>